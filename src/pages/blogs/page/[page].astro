---
import BlogListPage from "../../../components/Blogs/BlogListPage.astro";
import { BLOG_PER_PAGE } from "../../../consts";

const { page } = Astro.params;
const currentPage = Number(page);

// âœ… generate static paths
export async function getStaticPaths() {
  const uri = import.meta.env.PUBLIC_API_WP_BLOG;
  const data = await fetch(uri + "?per_page=100&_embed&acf_format=standard");
  const allBlogs = await data.json();

  const perPage = BLOG_PER_PAGE;
  const totalPages = Math.ceil(allBlogs.length / perPage);

  return Array.from({ length: totalPages }).map((_, i) => ({
    params: { page: String(i + 1) },
    props: { allBlogs },
  }));
}

const allBlogs = Astro.props.allBlogs;

if (currentPage < 1 || currentPage > Math.ceil(allBlogs.length / BLOG_PER_PAGE)) {
  throw new Error("Page not found");
}
---

<BlogListPage 
  allBlogs={allBlogs} 
  currentPage={currentPage} 
  perPage={BLOG_PER_PAGE} 
  baseUrl="/blogs"
/>
