---
// ไฟล์: src/components/Alumni/AlumniListView.astro
import Layout from "../../layouts/Layout.astro";
import MainBanner from "../Banner/MainBanner.astro";
import AlumniCard from "./AlumniCard.astro";
import UniqueType from "../uniqueType.astro";
import Pagination from "../Pagination.astro";
import Breadcrumbs from "../Breadcrumbs.astro";
import { getLangFromUrl, useTranslations } from "../../i18n/utils";

const lang = getLangFromUrl(Astro.url);
const t = useTranslations(lang);

// รับค่า Props ที่จะเปลี่ยนไปตามแต่ละหน้า
const {
  pageTitle,
  pageDesc,
  breadcrumbsItems,
  showIntroText = false, // หน้า gen จะไม่โชว์ข้อความนี้
  allAlumni = [], // ไว้หาเพื่อน
  displayAlumni = [], // ข้อมูลที่จะเอามาโชว์ (ตัดแบ่งหน้ามาให้แล้ว)
  currentPage,
  totalPages,
  paginationBaseUrl,
  emptyMessage = "ยังไม่มีข้อมูล"
} = Astro.props;

// ฟังก์ชันหาเพื่อน (มาอยู่ที่นี่ที่เดียวเลย)
const getMutualAvatars = (generationKey, currentSlug) => {
  if (!generationKey || !allAlumni.length) return [];
  return allAlumni
    .filter((item) => item.acf?.key === generationKey && item.slug !== currentSlug)
    .map((item) => ({
      image: item.acf?.image || item._embedded?.["wp:featuredmedia"]?.[0]?.source_url,
      name: item.title?.rendered || item.name,
      slug: item.slug,
    }));
};
---

<Layout title={`${pageTitle} | ${t("university")}`} description={pageDesc} lang={lang} isMenu={true}>
  <MainBanner title={pageTitle} description={pageDesc} />
  <div class="bg-a-yellow-FFF4DF">
    <div class="px-4 sm:px-16">
      <div class="container mx-auto">
        <Breadcrumbs items={breadcrumbsItems} />
        
        <div class="blog pb-8">
          {showIntroText && (
            <div>
              <h3 class="text-30 md:text-44 font-bold mb-4">เครือข่ายศิษย์เก่า</h3>
              <h4 class="text-20 md:text-24 max-w-4xl opacity-90 font-light mb-8">
                ตลอดระยะเวลาของ TEPCoT ได้สร้างเครือข่ายผู้บริหารระดับสูงที่มีบทบาทสำคัญต่อเศรษฐกิจและสังคมไทย...
              </h4>
            </div>
          )}

          <div class="grid grid-cols-2 md:grid-cols-5 gap-0 md:gap-4 lg:gap-8">
            <div class="col-span-4 lg:col-span-4 mb-0">
              
              {displayAlumni.length >= 1 ? (
                <>
                  <div class="grid grid-cols-2 md:grid-cols-3 gap-4 mb-16">
                    {displayAlumni.map((alumni) => {
                      const mutualFriends = getMutualAvatars(alumni.acf?.key, alumni.slug);
                      return <AlumniCard p={alumni} mutualAvatars={mutualFriends} />;
                    })}
                  </div>
                  <Pagination currentPage={currentPage} totalPages={totalPages} baseUrl={paginationBaseUrl} />
                </>
              ) : (
                <div class="text-center text-a-gray-696F6F py-16">
                  <p>{emptyMessage}</p>
                </div>
              )}

            </div>
            <div class="col-span-2 md:col-span-1 lg:col-span-1">
              <UniqueType type="alumni" />
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</Layout>